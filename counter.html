<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Counter Queue System</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    
    <!-- P5.js for visual rendering -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    
    <!-- Howler.js for audio management -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    
    <!-- Firebase Config -->
    <script src="js/firebase-config.js"></script>
    
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        /* Container and Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Section */
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* Warning Banner */
        .warning-banner {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            display: none;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        /* Counter Selection */
        .counter-selection {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .counter-select {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.1rem;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .counter-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Main Content Grid */
        .main-content {
            display: grid;
            gap: 25px;
            grid-template-columns: 1fr;
        }

        @media (min-width: 768px) {
            .main-content {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Queue Display Panel */
        .queue-panel {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .queue-panel h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .queue-status {
            display: grid;
            gap: 15px;
            margin-bottom: 25px;
        }

        .status-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .status-label {
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
        }

        .status-value {
            font-size: 1.3rem;
            color: #333;
            font-weight: bold;
        }

        /* Control Buttons */
        .control-buttons {
            display: grid;
            gap: 15px;
            margin-bottom: 25px;
        }

        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #f093fb, #f5576c);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(240, 147, 251, 0.3);
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Settings Panel */
        .settings-panel {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .settings-panel h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .setting-group {
            margin-bottom: 20px;
        }

        .setting-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .setting-group select,
        .setting-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            transition: all 0.3s ease;
        }

        .setting-group select:focus,
        .setting-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Volume Control */
        .volume-control {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .volume-slider {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        /* Recent Served List */
        .recent-served {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            margin-top: 25px;
        }

        .recent-served h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .served-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .served-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #28a745;
        }

        .served-number {
            font-weight: bold;
            color: #333;
        }

        .served-time {
            color: #666;
            font-size: 0.9rem;
        }

        /* P5.js Canvas Container */
        #p5-canvas {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            margin-top: 25px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .main-content {
                grid-template-columns: 1fr;
            }

            .btn {
                padding: 12px 20px;
                font-size: 1rem;
            }

            .control-buttons {
                grid-template-columns: 1fr;
            }
        }

        /* Loading States */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        /* Success/Error Messages */
        .message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Animation for new calls */
        @keyframes callAnimation {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .call-animation {
            animation: callAnimation 0.5s ease-in-out;
        }
    </style>
</head>
<body>
    <!-- PIN Modal -->
    <div id="pinModal" style="position:fixed;z-index:9999;top:0;left:0;width:100vw;height:100vh;background:rgba(40,40,60,0.97);display:flex;align-items:center;justify-content:center;transition:opacity 0.3s;">
        <div style="background:white;padding:2.5rem 2rem 2rem 2rem;border-radius:1.5rem;box-shadow:0 8px 32px rgba(0,0,0,0.18);max-width:95vw;width:350px;text-align:center;">
            <h2 style="font-size:1.5rem;font-weight:bold;color:#333;margin-bottom:1rem;">üîê Staff Login</h2>
            <p style="color:#666;margin-bottom:1.5rem;">Enter PIN to access counter panel</p>
            <input id="pinInput" type="password" maxlength="4" placeholder="0000" style="width:100%;padding:1rem;font-size:1.2rem;text-align:center;border:2px solid #ddd;border-radius:0.75rem;margin-bottom:1rem;outline:none;" autofocus />
            <div id="pinError" style="color:#e53e3e;font-size:1rem;margin-bottom:1rem;display:none;">Incorrect PIN. Please try again.</div>
            <button id="pinSubmit" style="width:100%;padding:0.9rem 0;font-size:1.1rem;font-weight:bold;background:linear-gradient(45deg,#667eea,#764ba2);color:white;border:none;border-radius:0.75rem;box-shadow:0 2px 8px rgba(102,126,234,0.12);cursor:pointer;transition:background 0.2s;">Enter</button>
        </div>
    </div>
    <!-- Notification Toast -->
    <div id="successToast" style="display:none;position:fixed;top:30px;left:50%;transform:translateX(-50%);z-index:9999;background:#38a169;color:white;padding:1rem 2rem;border-radius:1rem;box-shadow:0 4px 24px rgba(56,161,105,0.18);font-weight:bold;font-size:1.1rem;opacity:0;transition:opacity 0.4s,top 0.4s;">
        ‚úÖ Successful Edited
    </div>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üéØ Multi-Counter Queue System</h1>
            <p>Staff Control Panel - Manage Your Counter Efficiently</p>
        </div>

        <!-- Warning Banner -->
        <div class="warning-banner" id="warningBanner">
            ‚ö†Ô∏è Do not edit counter settings while customers are in queue
        </div>

        <!-- Counter Selection -->
        <div class="counter-selection">
            <label for="counterSelect" style="display: block; margin-bottom: 10px; font-weight: bold; color: #333;">
                Select Your Counter:
            </label>
            <select id="counterSelect" class="counter-select">
                <option value="">-- Choose Counter --</option>
                <option value="A">Counter A</option>
                <option value="B">Counter B</option>
                <option value="C">Counter C</option>
            </select>
        </div>

        <!-- Main Content Grid -->
        <div class="main-content">
            <!-- Queue Display Panel -->
            <div class="queue-panel">
                <h2>üìä Queue Status</h2>
                
                <div class="queue-status">
                    <div class="status-item">
                        <div class="status-label">Last Issued:</div>
                        <div class="status-value" id="lastIssued">--</div>
                    </div>
                    
                    <div class="status-item">
                        <div class="status-label">Now Serving:</div>
                        <div class="status-value" id="nowServing">--</div>
                    </div>
                    
                    <div class="status-item">
                        <div class="status-label">Queue Length:</div>
                        <div class="status-value" id="queueLength">0</div>
                    </div>
                </div>

                <div class="control-buttons">
                    <button class="btn btn-primary" id="callNextBtn" disabled>
                        üì¢ Call Next Number
                    </button>
                    <button class="btn btn-secondary" id="callAgainBtn" disabled>
                        üîÑ Call Again
                    </button>
                    <button class="btn btn-primary" id="markServedBtn" disabled>
                        ‚úÖ Mark as Served
                    </button>
                    <button class="btn btn-danger" id="resetQueueBtn" disabled>
                        üîÑ Reset Queue
                    </button>
                </div>
            </div>

            <!-- Settings Panel -->
            <div class="settings-panel">
                <h2>‚öôÔ∏è Counter Settings</h2>
                
                <div class="setting-group">
                    <label for="prefixSelect">Counter Prefix:</label>
                    <select id="prefixSelect" disabled>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                    </select>
                </div>

                <div class="setting-group">
                    <label for="sequenceType">Number Sequence:</label>
                    <select id="sequenceType" disabled>
                        <option value="sequential">Sequential (1, 2, 3...)</option>
                        <option value="odd">Odd Numbers (1, 3, 5...)</option>
                        <option value="even">Even Numbers (2, 4, 6...)</option>
                    </select>
                </div>

                <div class="volume-control">
                    <label for="volumeSlider">üîä Volume:</label>
                    <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="0.7" class="volume-slider">
                    <span id="volumeValue">70%</span>
                </div>
            </div>
        </div>

        <!-- Recent Served List -->
        <div class="recent-served">
            <h3>üìã Recently Served</h3>
            <div class="served-list" id="servedList">
                <div style="text-align: center; color: #666; padding: 20px;">
                    No customers served yet
                </div>
            </div>
        </div>

        <!-- P5.js Canvas for Visual Effects -->
        <div id="p5-canvas">
            <h3>üé® Visual Queue Display</h3>
            <div id="p5-container"></div>
        </div>
    </div>

    <script>
        // Global Variables
        let currentCounter = null;
        let queueData = {};
        let audioContext = null;
        let callSound = null;
        let volumeLevel = 0.7;
        let isQueueActive = false;
        let recentServed = [];

        // Initialize Howler.js audio
        function initializeAudio() {
            // Create a simple beep sound using Web Audio API
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            callSound = new Howl({
                src: ['data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT'],
                volume: volumeLevel,
                onload: function() {
                    console.log('üîä Audio loaded successfully');
                },
                onloaderror: function() {
                    console.log('‚ùå Audio loading failed, using fallback');
                    createFallbackSound();
                }
            });
        }

        // Fallback sound creation
        function createFallbackSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volumeLevel, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
                
                callSound = { play: () => createFallbackSound() };
            } catch (error) {
                console.log('‚ùå Fallback audio creation failed');
                callSound = { play: () => console.log('üîä Audio not available') };
            }
        }

        // Initialize P5.js for visual effects
        function initializeP5() {
            new p5(function(p) {
                p.setup = function() {
                    const canvas = p.createCanvas(400, 200);
                    canvas.parent('p5-container');
                    p.background(240);
                };

                p.draw = function() {
                    p.background(240);
                    
                    // Draw queue visualization
                    if (currentCounter && queueData[currentCounter]) {
                        const counter = queueData[currentCounter];
                        
                        // Draw counter status
                        p.fill(50);
                        p.textSize(16);
                        p.textAlign(p.CENTER);
                        p.text(`Counter ${currentCounter}`, p.width/2, 30);
                        
                        // Draw current number
                        p.fill(0, 150, 0);
                        p.textSize(24);
                        p.text(counter.nowServing || '--', p.width/2, 70);
                        
                        // Draw queue length
                        p.fill(100);
                        p.textSize(14);
                        p.text(`Queue: ${counter.queueLength || 0}`, p.width/2, 100);
                        
                        // Animate when calling
                        if (counter.isCalling) {
                            p.fill(255, 0, 0, 100);
                            p.ellipse(p.width/2, 70, 100, 50);
                        }
                    } else {
                        p.fill(100);
                        p.textSize(16);
                        p.textAlign(p.CENTER);
                        p.text('Select a counter to view status', p.width/2, p.height/2);
                    }
                };
            });
        }

        // Firebase Database Operations
        function initializeFirebase() {
            // Listen for counter data changes
            database.ref('counters').on('value', (snapshot) => {
                queueData = snapshot.val() || {};
                updateUI();
                checkQueueStatus();
            });

            // Listen for global queue status
            database.ref('queueStatus').on('value', (snapshot) => {
                const status = snapshot.val() || {};
                isQueueActive = status.isActive || false;
                updateWarningBanner();
            });
        }

        // Initialize counter data if not exists
        function initializeCounterData() {
            const counters = ['A', 'B', 'C'];
            const defaultData = {};
            
            counters.forEach(counter => {
                defaultData[counter] = {
                    prefix: counter,
                    sequenceType: 'sequential',
                    lastIssued: `${counter}000`,
                    nowServing: null,
                    queueLength: 0,
                    isCalling: false,
                    settings: {
                        prefix: counter,
                        sequenceType: 'sequential'
                    }
                };
            });

            database.ref('counters').once('value', (snapshot) => {
                if (!snapshot.exists()) {
                    database.ref('counters').set(defaultData);
                }
            });
        }

        // UI Update Functions
        function updateUI() {
            if (!currentCounter || !queueData[currentCounter]) return;

            const counter = queueData[currentCounter];
            
            // Update status display
            document.getElementById('lastIssued').textContent = counter.lastIssued || '--';
            document.getElementById('nowServing').textContent = counter.nowServing || '--';
            document.getElementById('queueLength').textContent = counter.queueLength || 0;
            
            // Update settings
            document.getElementById('prefixSelect').value = counter.settings?.prefix || currentCounter;
            document.getElementById('sequenceType').value = counter.settings?.sequenceType || 'sequential';
            
            // Update button states
            const hasQueue = counter.queueLength > 0;
            document.getElementById('callNextBtn').disabled = !hasQueue;
            document.getElementById('callAgainBtn').disabled = !counter.nowServing;
            document.getElementById('markServedBtn').disabled = !counter.nowServing;
            document.getElementById('resetQueueBtn').disabled = !hasQueue;
        }

        function updateWarningBanner() {
            const banner = document.getElementById('warningBanner');
            if (isQueueActive) {
                banner.style.display = 'block';
                // Disable settings when queue is active
                document.getElementById('prefixSelect').disabled = true;
                document.getElementById('sequenceType').disabled = true;
            } else {
                banner.style.display = 'none';
                // Enable settings when queue is inactive
                if (currentCounter) {
                    document.getElementById('prefixSelect').disabled = false;
                    document.getElementById('sequenceType').disabled = false;
                }
            }
        }

        // Queue Management Functions
        function callNextNumber() {
            if (!currentCounter || !queueData[currentCounter]) return;

            const counter = queueData[currentCounter];
            if (counter.queueLength <= 0) return;

            // Get next number based on sequence type
            const nextNumber = getNextNumber(counter);
            
            // Update counter data
            const updates = {};
            updates[`counters/${currentCounter}/nowServing`] = nextNumber;
            updates[`counters/${currentCounter}/isCalling`] = true;
            
            database.ref().update(updates).then(() => {
                // Play sound
                if (callSound) {
                    callSound.volume(volumeLevel);
                    callSound.play();
                }
                
                // Show call animation
                document.getElementById('nowServing').classList.add('call-animation');
                setTimeout(() => {
                    document.getElementById('nowServing').classList.remove('call-animation');
                }, 500);
                
                // Stop calling animation after 3 seconds
                setTimeout(() => {
                    database.ref(`counters/${currentCounter}/isCalling`).set(false);
                }, 3000);
            });
        }

        function getNextNumber(counter) {
            const prefix = counter.settings?.prefix || currentCounter;
            const sequenceType = counter.settings?.sequenceType || 'sequential';
            
            // Parse current number
            const currentNum = parseInt(counter.lastIssued.replace(prefix, '')) || 0;
            let nextNum;
            
            switch (sequenceType) {
                case 'sequential':
                    nextNum = currentNum + 1;
                    break;
                case 'odd':
                    nextNum = currentNum % 2 === 0 ? currentNum + 1 : currentNum + 2;
                    break;
                case 'even':
                    nextNum = currentNum % 2 === 1 ? currentNum + 1 : currentNum + 2;
                    break;
                default:
                    nextNum = currentNum + 1;
            }
            
            return `${prefix}${nextNum.toString().padStart(3, '0')}`;
        }

        function markAsServed() {
            if (!currentCounter || !queueData[currentCounter]) return;

            const counter = queueData[currentCounter];
            if (!counter.nowServing) return;

            // Add to recent served
            const servedItem = {
                number: counter.nowServing,
                timestamp: new Date().toLocaleTimeString(),
                counter: currentCounter
            };
            
            recentServed.unshift(servedItem);
            if (recentServed.length > 10) {
                recentServed.pop();
            }
            
            updateServedList();
            
            // Update counter data
            const updates = {};
            updates[`counters/${currentCounter}/nowServing`] = null;
            updates[`counters/${currentCounter}/queueLength`] = Math.max(0, counter.queueLength - 1);
            
            database.ref().update(updates);
        }

        function callAgain() {
            if (!currentCounter || !queueData[currentCounter]) return;

            const counter = queueData[currentCounter];
            if (!counter.nowServing) return;

            // Play sound again
            if (callSound) {
                callSound.volume(volumeLevel);
                callSound.play();
            }
        }

        // PIN Modal Logic
        function showPinModal() {
            const modal = document.getElementById('pinModal');
            const input = document.getElementById('pinInput');
            const error = document.getElementById('pinError');
            const submit = document.getElementById('pinSubmit');
            modal.style.display = 'flex';
            input.value = '';
            error.style.display = 'none';
            input.focus();
            submit.onclick = function() {
                if (input.value === '0108') {
                    sessionStorage.setItem('counterAuth', 'true');
                    modal.style.opacity = '0';
                    setTimeout(()=>{modal.style.display='none';},300);
                } else {
                    error.style.display = 'block';
                    input.value = '';
                    input.focus();
                }
            };
            input.onkeypress = function(e) {
                if (e.key === 'Enter') submit.click();
            };
        }

        // On load, check sessionStorage
        window.addEventListener('DOMContentLoaded', function() {
            if (sessionStorage.getItem('counterAuth') !== 'true') {
                showPinModal();
            } else {
                document.getElementById('pinModal').style.display = 'none';
            }
        });

        // Show Success Toast
        function showSuccessToast() {
            const toast = document.getElementById('successToast');
            toast.style.display = 'block';
            setTimeout(()=>{
                toast.style.opacity = '1';
                toast.style.top = '60px';
            },10);
            setTimeout(()=>{
                toast.style.opacity = '0';
                toast.style.top = '30px';
                setTimeout(()=>{toast.style.display='none';},400);
            }, 2000);
        }

        // Settings Change Logic
        document.getElementById('prefixSelect').addEventListener('change', function() {
            saveCounterSettings();
        });
        document.getElementById('sequenceType').addEventListener('change', function() {
            saveCounterSettings();
        });
        function saveCounterSettings() {
            if (!currentCounter || !queueData[currentCounter]) return;
            const prefix = document.getElementById('prefixSelect').value;
            const sequenceType = document.getElementById('sequenceType').value;
            database.ref(`counters/${currentCounter}/settings`).set({prefix, sequenceType}).then(()=>{
                showSuccessToast();
            });
        }
    </script>
</body>
</html>   